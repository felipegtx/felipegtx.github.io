<html>
<head>
    <title>Rask</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
</head>
<body>
    <div class="container">
        <nav class="navbar navbar-default">
            <div class="container">
                <a class="navbar-brand" href="#">Raska!</a>
            </div>
        </nav>
        <div>
            <ul class="list-group">
                <li class="list-group-item">
                    Click on a node and press <em>enter</em> to delete it
                </li>
                <li class="list-group-item">
                    Drag a node (using right click) and move it over another to create a link
                </li>
                <li class="list-group-item">
                    Dependency graph outputs the JSON to browser' console
                </li>
            </ul>
        </div>
        <div class="form-inline">
            <div class="form-group">
                <label for="elementLabel">Label:</label><input class="form-control" type="text" id="elementLabel" name="elementLabel" />
            </div>
            <button class="btn btn-default" onclick="addSquare();">Add square</button>
            <button class="btn btn-default" onclick="addCircle();">Add circle</button>
            <button class="btn btn-default" onclick="saveImage();">Save image</button>
            <button class="btn btn-default" onclick="getGraph();">Get dependency graph</button>
        </div>
        <br />
        <div class="row">
            <table class="table">
                <tr>
                    <td>
                        <canvas id="raskaContent" style="border: 1px solid silver" width="800" height="600"></canvas>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <script>
        /// Grab the original file at https://github.com/felipegtx/Raska
        /// Read about it (Pt-br) at http://felipegte.com
        !function (e) { "use strict"; var t = function () { return { $log: { active: !0, info: function (e, t) { console.info(e, t) } }, $obj: function () { return { is: function (e, t) { return typeof e === t }, isUndefined: function (e) { return this.is(e, "undefined") }, extend: function (e, t, n) { var r = {}, i = null; if (this.isUndefined(t)) for (i in e) r[i] = e[i]; else { n === !0 && (r = t); for (i in e) r.hasOwnProperty(i) || (r[i] = t.hasOwnProperty(i) ? t[i] : e[i]) } return r } } }() } }(), n = { relative: 0, absolute: 1 }, r = function () { function e(e, t) { for (var n = 0; n < e.length; n++) t(e[n]); return [] } var t = null, r = [], o = [], l = []; return { name: "anonymous", addLinkTo: function (e) { return -1 === r.indexOf(e) && (r.push(e), e.addLinkFrom(this)), this }, removeLinkTo: function (e) { return r.splice(r.indexOf(e), 1), this }, getLinksTo: function () { return r }, addLinkFrom: function (e) { return -1 === o.indexOf(e) && (o.push(e), e.addLinkTo(this)), this }, getLinksFrom: function () { return o }, removeLinkFrom: function (e) { return o.splice(o.indexOf(e), 1), this }, clearAllLinks: function () { return r = e(r, function (e) { e.removeLinkFrom(this) }), o = e(o, function (e) { e.removeLinkTo(this) }), this }, getChildElements: function () { return l }, addChild: function (e) { return e.setParent(this), l.push(e), this }, getParent: function () { return t }, setParent: function (e) { return t = e, this }, border: { color: null, active: !1, width: 0 }, position: n.relative, x: 50, y: 50, getAdjustedCoordinates: function () { if (this.position === n.relative && null !== t) { var e = t.getAdjustedCoordinates(); return { x: this.x + e.x, y: this.y + e.y } } return { x: this.x, y: this.y } }, getWidth: function () { throw console.error(i.errors.notImplementedException), i.errors.notImplementedException }, getHeight: function () { throw console.error(i.errors.notImplementedException), i.errors.notImplementedException }, existsIn: function () { throw console.error(i.errors.notImplementedException), i.errors.notImplementedException }, drawTo: function () { throw console.error(i.errors.notImplementedException), i.errors.notImplementedException } } }, i = { library: { readonly: !1, frameRefreshRate: 20, targetCanvasId: "" }, errors: { notImplementedException: { message: "Not implemented", code: 0 } }, label: function () { return t.$obj.extend(new r, { name: "label", text: "", color: "white", x: 0, y: 0, border: { color: "red", active: !0, width: 4 }, font: { family: "Tahoma", size: "12px" }, getWidth: function () { return 5 * this.text.length }, getHeight: function () { return this.font.size }, drawTo: function (e, t) { var n = this.getAdjustedCoordinates(); t.font = this.font.size + " " + this.font.family, t.textBaseline = "middle", t.textAlign = "center", this.border.active === !0 && (t.lineJoin = "round", t.lineWidth = this.border.width, t.strokeStyle = this.border.color, t.strokeText(this.text, n.x, n.y)), t.fillStyle = this.color, t.fillText(this.text, n.x, n.y) }, existsIn: function () { return !1 } }, !0) }, square: function () { return t.$obj.extend(new r, { name: "square", border: { color: "gray", active: !0, width: 4 }, fillColor: "silver", dimensions: { width: 30, height: 50 }, globalAlpha: 1, getWidth: function () { return this.dimensions.width }, getHeight: function () { return this.dimensions.height }, drawTo: function (e, t) { var n = this.getAdjustedCoordinates(); t.beginPath(), t.rect(n.x, n.y, this.dimensions.width, this.dimensions.height), t.fillStyle = this.fillColor, this.border.active === !0 && (t.lineWidth = this.border.width, t.strokeStyle = this.border.color), t.globalAlpha = this.globalAlpha, t.fill(), t.stroke() }, existsIn: function (e, t) { return e > this.x - this.dimensions.width && e < this.x + this.dimensions.width && t > this.y - this.dimensions.height && t < this.y + this.dimensions.height } }, !0) }, arrow: function () { var e = function (e, t, n, r, i) { e.save(), e.beginPath(), e.fillStyle = i, e.strokeStyle = i, e.translate(t, n), e.rotate(r), e.moveTo(0, 0), e.lineTo(5, 20), e.lineTo(-5, 20), e.closePath(), e.restore(), e.fill() }; return t.$obj.extend(new r, { name: "arrow", border: { color: "black", active: !0, width: 1 }, fillColor: "green", getWidth: function () { return 1 }, getHeight: function () { return 1 }, drawTo: function (t, n) { var r = this.getParent(); n.beginPath(), n.fillStyle = this.fillColor, this.border.active === !0 && (n.lineWidth = this.border.width, n.strokeStyle = this.border.color), n.moveTo(this.x, this.y), n.lineTo(r.x, r.y), n.stroke(); var i = Math.atan((r.y - this.y) / (r.x - this.x)); i += (r.x > this.x ? -90 : 90) * Math.PI / 180, e(n, this.x, this.y, i) }, existsIn: function () { return !1 } }, !0) }, circle: function () { return t.$obj.extend(new r, { name: "circle", border: { color: "red", active: !0, width: 4 }, fillColor: "black", radius: 20, getWidth: function () { return 2 * this.radius }, getHeight: function () { return 2 * this.radius }, drawTo: function (e, t) { var n = this.getAdjustedCoordinates(); t.beginPath(), t.arc(n.x, n.y, this.radius, 0, 2 * Math.PI, !1), t.fillStyle = this.fillColor, t.fill(), this.border.active === !0 && (t.lineWidth = this.border.width, t.strokeStyle = this.border.color), t.stroke() }, existsIn: function (e, t) { var n = this.x - e, r = this.y - t; return n * n + r * r < this.radius * this.radius } }, !0) } }, o = null, l = function () { var n = [], r = null, l = !1, s = null, u = null, d = function () { null !== r && e.clearTimeout(r), l === !0 && (r = e.setTimeout(function () { y(), d() }, o.frameRefreshRate)) }, a = function (e) { e.drawTo(s, u); var t = e.getChildElements(), n = 0; for (n = 0; n < t.length; n++) t[n].drawTo(s, u); var r = e.getLinksFrom(), o = null; for (n = 0; n < r.length; n++) o = new i.arrow, o.setParent(r[n]), o.x = e.x, o.y = e.y, o.drawTo(s, u) }, c = { getX: function (e) { var t = s.getBoundingClientRect(); return (e.clientX - t.left) * (s.width / t.width) }, getY: function (e) { var t = s.getBoundingClientRect(); return (e.clientY - t.top) * (s.height / t.height) } }, h = { reference: null, originalBorder: {}, dragTypes: { moving: 1, linking: 3 }, dragType: 0, border: { whenMoving: { color: "yellow", active: !0 }, whenLiking: { color: "green", active: !0 } } }, f = function (e) { null !== h.reference && (t.$log.info("Moving element", h), h.reference.x = c.getX(e), h.reference.y = c.getY(e)) }, g = function (e) { if (null !== h.reference) { if (h.dragType === h.dragTypes.linking) for (var t = 0; t < n.length; t++) if (n[t] !== h.reference && n[t].existsIn(c.getX(e), c.getY(e))) { n[t].addLinkFrom(h.reference); break } h.reference.border = h.originalBorder, h.reference = null } }, m = function (e) { t.$log.info("Removing element", e), n.splice(n.indexOf(e), 1) }, x = function (e) { t.$log.info("Adding element", e), n.push(e) }, v = function (e) { 46 == (e.keyCode || e.charCode) && null !== h.reference && (m(h.reference.clearAllLinks()), h.reference = null) }, w = function (r) { r = r || e.event; for (var i = 0; i < n.length; i++) n[i].existsIn(c.getX(r), c.getY(r)) && (h.reference = n[i]); return null !== h.reference && (h.originalBorder = h.reference.border, h.reference.border = (h.dragType = r.which) === h.dragTypes.moving ? h.border.whenMoving : h.border.whenLiking, t.$log.info("Dragging element", h.reference)), r.preventDefault ? r.preventDefault() : r.returnValue && (r.returnValue = !1), !1 }, y = function () { null === s && (u = (s = document.getElementById(o.targetCanvasId)).getContext("2d"), s.addEventListener("mousedown", w, !1), e.addEventListener("mousemove", f, !1), e.addEventListener("mouseup", g, !1), e.addEventListener("keydown", v, !1), s.addEventListener("contextmenu", function (e) { return e.preventDefault(), !1 }, !1)), u.clearRect(0, 0, s.width, s.height); for (var t = 0; t < n.length; t++) a(n[t]) }, p = function (e, t) { for (var n, r = [], i = 0; i < e.length; i++) n = e[i], t !== n && r.push({ name: n.name, childs: p(n.getChildElements().slice(), t || n), links: p(n.getLinksTo().slice(), t || n) }); return r }; return { addElement: function (e) { x(e) }, getDataUrl: function () { return s.toDataURL() }, getElements: function () { return p(n) }, initializeTimedDrawing: function () { l === !1 && (l = !0, d()) } } }(), s = { newLabel: function () { return t.$obj.extend(new i.label, {}) }, newSquare: function () { return t.$obj.extend(new i.square, {}) }, newCircle: function () { return t.$obj.extend(new i.circle, {}) }, plot: function (e) { return l.addElement(e), s }, exportImage: function () { var e = window.open(); e.document.write("<img src='" + l.getDataUrl() + "'>") }, getElements: function () { return l.getElements() }, installUsing: function (e) { return o = t.$obj.extend(i.library, e), l.initializeTimedDrawing(), s } }; e.raska = s }(window);
    </script>
    <script>



        /// Configures raska to a given Canvas element
        raska.installUsing({ targetCanvasId: "raskaContent" });

        /// Adds some elements so we can play with...
        for (var i = 0; i < 10; i++) {

            /// Circle
            var circle = raska.newCircle();
            circle.x += (100 * i);
            var label = raska.newLabel();
            label.text = "label for circle " + i;
            circle.addChild(label);
            raska.plot(circle);

            /// Square
            var square = raska.newSquare();
            square.y += 100;
            square.x += (100 * i);
            var label = raska.newLabel();
            label.text = "label for square " + i;
            square.addChild(label);
            raska.plot(square);
        }

        function addSquare() {
            var square = raska.newSquare();
            var label = raska.newLabel();
            label.text = document.getElementById("elementLabel").value;
            square.addChild(label);
            raska.plot(square);
        }

        function addCircle() {
            var circle = raska.newCircle();
            var label = raska.newLabel();
            label.text = document.getElementById("elementLabel").value;
            circle.addChild(label);
            raska.plot(circle);
        }

        function saveImage() {
            raska.exportImage();
        }

        function getGraph() {
            console.log(raska.getElements());
            alert("Exported to the console");
        }
    </script>
</body>
</html>
