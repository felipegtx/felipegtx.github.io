(function(n,t){"use strict";var c=t.querySelector.bind(t),i=function(){return n.requestAnimationFrame=function(){var t=null;return n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.msRequestAnimationFrame||n.oRequestAnimationFrame||function(i){t!==null&&n.clearTimeout(t);t=n.setTimeout(i,f.frameRefreshRate)}}(),{$dom:function(){var r=function(t){return i.$obj.is(t.raw,"function")&&(t=t.raw()),{css:function(n,u){if(i.$obj.isType(n,"string")){if(i.$obj.isUndefined(u))return t.style[n];if(u==="")return r(t).removeCss(n);t.style[n]=u}else for(var f in n)r(t).css(f,n[f]);return r(t)},removeCss:function(n){return t.style.removeProperty?t.style.removeProperty(n):t.style[n]="",r(t)},attr:function(n,u){if(i.$obj.isType(n,"string")){if(i.$obj.isUndefined(u))return t.getAttribute(n);t.setAttribute(n,u)}else for(var f in n)r(t).attr(f,n[f]);return r(t)},raw:function(){return t},getXYPositionFrom:function(n){i.$device.isTouch&&i.$obj.is(n.touches.length,"number")&&n.touches.length>0&&(n=n.touches[0]);var r=t.getBoundingClientRect();return{x:(n.clientX-r.left)*(t.width/r.width),y:(n.clientY-r.top)*(t.height/r.height)}},addChild:function(n){if(i.$obj.isType(n,"string")){var f=u.create(n);return t.appendChild(f.raw()),f}return t.appendChild(n),r(n)},type:function(){return t.nodeName},getParent:function(){return r(t.parentElement?t.parentElement:t.parentNode)},addSibling:function(n){return r(t).getParent().addChild(n)},html:function(n){return i.$obj.isType(n,"string")?(t.innerHTML=n,r(t)):t.innerHTML},text:function(n){return i.$obj.isType(n,"string")?(t.innerText=n,r(t)):t.innerText},on:function(i,u){return n.addEventListener?t.addEventListener(i,u,!1):n.attachEvent?t.attachEvent("on"+i,u):t["on"+i]=u,r(t)},first:function(n){var u=t.querySelectorAll(":scope > "+n);return i.$obj.isType(u,"nodelist")?r(u[0]):null}}},u={create:function(n,u){var f=t.createElement(n);return f.id=i.$obj.generateId(),i.$obj.isValid(u)&&r(u).addChild(f),r(f)},get:function(n){var t=i.$obj.isType(n,"string")?c(n):n;return r(t)},getById:function(n){return r(c("#"+n))}};return u}(),$device:function(){var r="ontouchstart"in n||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,t={isTouch:r,gathersXYPositionFrom:function(n,t){return i.$dom.get(n).getXYPositionFrom(t)},on:function(n,r,u){i.$dom.get(n).on(r,u);return t}};return t}(),$log:{active:!1,info:function(n,t){this.active===!0&&console.info(n,t)}},$obj:function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function u(n,t){for(var i,f,e=0;e<n.length;e++){if(i=n[e],i.graphNode===!0&&((f=i.getLinksFrom())===null||f.length===0)&&((f=i.getLinksTo())===null||f.length===0))throw new r.errors.elementDoesNotHaveALink(i.name);i.isSerializable()&&(t.push(i.normalize()),u(i.getChildElements(),t))}}var t;return t={forEach:function(n,i){var u=[],r;if(t.isArray(n))for(r=0;r<n.length;r++)u.push(i(n[r],r));return u},is:function(n,t){return typeof n===t},isType:function(n,t){return this.isValid(n)&&Object.prototype.toString.call(n).toLowerCase()==="[object "+t.toLowerCase()+"]"},generateId:function(){return"__"+n()+n()+n()+n()+n()+n()+n()+n()},isValid:function(n){return!this.is(n,"undefined")&&n!==null},isArray:function(n){return this.isValid(n)&&this.isType(n,"Array")},isUndefined:function(n){return this.is(n,"undefined")},deconstruct:function(n){var t=[];return i.$obj.isArray(n)&&u(n,t),JSON.stringify(t)},recreate:function(n){if(this.isValid(n.type)&&n.type in e){var t=this.extend(new r[n.type],n);return t.getType=function(){return n.type},t}return null},recreateLinks:function(n,t,i){this.forEach(this.forEach(t.linksTo,i),n.addLinkTo.bind(n));this.forEach(this.forEach(t.childElements,i),n.addChild.bind(n));t.parent!==null&&i(t.parent).addChild(n)},extend:function(n,t,i){var u={},r=null;if(this.isUndefined(t))for(r in n)u[r]=n[r];else{i===!0&&(u=t);for(r in n)u.hasOwnProperty(r)||(u[r]=t.hasOwnProperty(r)?t[r]:n[r])}return u}}}()}}(),l=function(n,t,r){var f=t||null,e=[],u;for(this.element=n,this.hasParent=function(n){return f!==null&&(f.element===n||f.getName()===n.name||f.hasParent(n))},this.getParentGraphNodeFor=function(n){return this.element===n||this.getName()===n.name?this:f!==null?this.getParent(n):null},this.getName=function(){return n.name},this.getParent=function(){return f},this.getLinks=function(){return e},u=0;u<r.length;u++)r[u].graphNode===!0&&(this.hasParent(r[u])?i.$log.info("ingored parent node",this.getParentGraphNodeFor(r[u])):e.push(new l(r[u],this,r[u].getLinksTo())))},o={relative:0,absolute:1},e={basic:"basic",html:"htmlElement",arrow:"arrow",circle:"circle",square:"square",label:"label",triangle:"triangle"},s=function(){function v(n,t){for(var i=0;i<n.length;i++)t(n[i]);return[]}var a=i.$dom.create("canvas").attr({width:"1",height:"1"}),s=a.raw().getContext("2d"),y=function(){},c=!1,f=null,n=[],t=[],u=[],l,h=[];return l={attr:{},name:"anonymous",getType:function(){return e.basic},graphNode:!0,canLink:function(n,t){return n===this?i.$obj.isValid(t)&&t.canReach(this)===!1:!0},disable:function(){return c=!0,i.$obj.forEach(h,function(n){i.$obj.is(n,"function")?n(this):n.elementDisabledNotification(this)}.bind(this)),h.length=0,this.clearAllLinks(),i.$obj.forEach(u,function(n){n.disable()}),u.length=0,this.drawTo=y,this},notifyDisableStateOn:function(n){return h.indexOf(n)===-1&&(i.$obj.isValid(n.elementDisabledNotification)||i.$obj.is(n,"function"))&&h.push(n),this},elementDisabledNotification:function(){return this},canReach:function(t){if(n.length>0)for(var i=0;i<n.length;i++)if(n[i].canReach(t))return!0;return this===t},isLinkable:function(){return!c},isSerializable:function(){return!c},addLinkTo:function(t){return i.$obj.isValid(t.isLinkable)&&t.isLinkable()&&this.isLinkable()&&n.indexOf(t)===-1&&t!==this&&this.canLink(this,t)?(n.push(t),t.addLinkFrom(this),!0):!1},addLinkFrom:function(n){return i.$obj.isValid(n.isLinkable)&&n.isLinkable()&&this.isLinkable()&&t.indexOf(n)===-1&&n!==this&&this.canLink(n,this)?(t.push(n),n.addLinkTo(this),!0):!1},removeLinkTo:function(t){return n.indexOf(t)>-1&&(n.splice(n.indexOf(t),1),t.removeLinkFrom(this)),this},normalize:function(){var n=function(n){return n.name},t=i.$obj.extend(this,{linksTo:i.$obj.forEach(this.getLinksTo(),n),childElements:i.$obj.forEach(this.getChildElements(),n),parent:i.$obj.isValid(f)?f.name:null,type:this.getType()},!0);return delete t.on,t},getLinksTo:function(){return n},getLinksFrom:function(){return t},removeLinkFrom:function(n){return t.indexOf(n)>-1&&(t.splice(t.indexOf(n),1),n.removeLinkTo(this)),this},clearAllLinks:function(){return n=v(n,function(n){n.removeLinkFrom(this)}.bind(this)),t=v(t,function(n){n.removeLinkTo(this)}.bind(this)),this},getChildElements:function(){return u},addChild:function(n){return n.setParent(this),u.push(n),this},getParent:function(){return f},getBoundaries:function(){return{x:this.getWidth(),y:this.getHeight(),minX:0,minY:0}},setParent:function(n){return f=n,this},border:{color:null,active:!1,width:0},position:o.relative,x:50,y:50,getAdjustedCoordinates:function(){if(this.position===o.relative&&f!==null){var n=f.getAdjustedCoordinates();return{x:this.x+n.x,y:this.y+n.y}}return{x:this.x,y:this.y}},canHandleEvents:function(){return!0},on:function(){function r(n,t,r,u,f){i.$obj.forEach(f,function(i){i(n,t,r,u)})}var n=[],t=[];return{click:function(t,f,e,o){var s,h;return i.$obj.isType(t,"number")===!0?(s=!1,u.length>0&&(h=e.getAdjustedCoordinates(),i.$obj.forEach(u,function(n){var i={x:t-h.x,y:f-h.y};n.canHandleEvents()&&n.existsIn(i.x,i.y)&&(n.on.click(i.x,i.y,n,o),s=!0)})),s===!1&&r(t,f,e,o,n)):i.$obj.isType(t,"function")===!0&&n.push(t),l},release:function(n,f,e,o){var s,h;return i.$obj.isType(n,"number")===!0?(s=!1,u.length>0&&(h=e.getAdjustedCoordinates(),i.$obj.forEach(u,function(t){var i={x:n-h.x,y:f-h.y};t.canHandleEvents()&&t.existsIn(i.x,i.y)&&(t.on.release(i.x,i.y,t,o),s=!0)})),s===!1&&r(n,f,e,o,t)):i.$obj.isType(n,"function")===!0&&t.push(n),l}}}(),existsIn:function(n,t){s.setTransform(1,0,0,1,-n,-t);this.drawTo(a,s);var i=!1;try{i=s.getImageData(0,0,1,1).data[3]>1}catch(r){}return s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,2,2),i},adjustPosition:function(){console.error(r.errors.notImplementedException);throw r.errors.notImplementedException;},setWidth:function(){console.error(r.errors.notImplementedException);throw r.errors.notImplementedException;},getWidth:function(){console.error(r.errors.notImplementedException);throw r.errors.notImplementedException;},getAdjustedWidth:function(){return this.getWidth()},setHeight:function(){console.error(r.errors.notImplementedException);throw r.errors.notImplementedException;},getHeight:function(){console.error(r.errors.notImplementedException);throw r.errors.notImplementedException;},getAdjustedHeight:function(){return this.getHeight()},drawTo:function(){console.error(r.errors.notImplementedException);throw r.errors.notImplementedException;}}},a=function(){var r=!1,n={container:{width:0,height:0,position:0,"z-index":0,left:0,top:0},canvas:{width:0,height:0}};return{toggleFullScreen:function(u,e){var s=i.$dom.getById(f.targetCanvasContainerId),h=i.$dom.get(u),c=e?40:0,o;if(r===!1){for(o in n.container)n.container[o]=s.css(o);s.css({width:t.body.clientWidth,height:t.body.clientHeight-c,position:"fixed","z-index":1e3,"background-color":"white",left:0,top:0});for(o in n.canvas)n.canvas[o]=h.attr(o);h.attr({width:t.body.clientWidth,height:t.body.clientHeight-c});i.$obj.isValid(e)&&i.$dom.getById(e).first("button").html("<span class='glyphicon glyphicon-resize-small'><\/span>&nbsp;Back to normal");r=!0}else{for(o in n.container)s.css(o,n.container[o]);for(o in n.canvas)h.attr(o,n.canvas[o]);i.$obj.isValid(e)&&i.$dom.getById(e).first("button").html("<span class='glyphicon glyphicon-resize-full'><\/span>&nbsp;Fullscreen");r=!1}}}}(),r={library:{readonly:!1,frameRefreshRate:30,targetCanvasId:"",targetCanvasContainerId:"____raska"+i.$obj.generateId(),toolboxButtons:[{id:"",name:"fullscreen",enabled:!0,onclick:function(n){a.toggleFullScreen(n,this.id)},template:"<button class='btn btn-primary btn-sm'><span class='glyphicon glyphicon-resize-full'><\/span>&nbsp;Fullscreen<\/button>"}]},errors:{notImplementedException:{message:"Not implemented",code:0},nullParameterException:function(n){if(typeof n=="undefined"||n===null)throw new this.nullParameterException("parameterName");this.message="Parameter can't be null";this.parameterName=n;this.code=1},elementDoesNotHaveALink:function(n){if(typeof n=="undefined"||n===null)throw new this.nullParameterException("elementName");return{message:"Element '"+n+"' doesn't have a valid linked sibling",elementName:n,code:2}},itemNotFoundException:function(n){if(typeof n=="undefined"||n===null)throw new this.nullParameterException("elementName");return{message:"Element '"+n+"' wasn't found",elementName:n,code:3}}},label:function(){return i.$obj.extend(new s,{name:"label"+i.$obj.generateId(),graphNode:!1,getType:function(){return e.label},canLink:function(){return!1},isLinkable:function(){return!1},text:"",color:"gray",x:0,y:0,border:{color:"white",active:!0,width:2},font:{family:"Arial",size:"12px",decoration:""},getWidth:function(){return this.text.length*5},getHeight:function(){return this.font.size},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.save();t.font=(this.font.decoration||"")+" "+this.font.size+" "+this.font.family;this.border.active===!0&&(t.lineJoin="round",t.lineWidth=this.border.width,t.strokeStyle=this.border.color,t.strokeText(this.text,i.x,i.y));t.fillStyle=this.color;t.fillText(this.text,i.x,i.y);t.restore()},existsIn:function(){return!1}},!0)},square:function(n){var t=n||{width:50,height:50};return i.$obj.extend(new s,{name:"square"+i.$obj.generateId(),getType:function(){return e.square},border:{color:"gray",active:!0,width:2},fillColor:"silver",dimensions:t,globalAlpha:1,getWidth:function(){return this.dimensions.width},getHeight:function(){return this.dimensions.height},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.beginPath();t.rect(i.x,i.y,this.dimensions.width,this.dimensions.height);t.fillStyle=this.fillColor;this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.globalAlpha=this.globalAlpha;t.fill();t.stroke()},existsIn:function(n,t){return n>=this.x&&n<=this.x+this.dimensions.width&&t>=this.y&&t<=this.y+this.dimensions.height},adjustPosition:function(n,t){var i=this.getParent();if(this.position===o.relative&&i!==null){var s=i.getAdjustedCoordinates(),r=i.getWidth()/2,u=i.getHeight()/2,f=n-s.x-r,e=t-s.y-u;this.x=f<0?Math.max(f,r*-1):Math.min(f,r);this.y=e<0?Math.max(e,u*-1):Math.min(e,u)}else this.x=n,this.y=t;return this}},!0)},arrow:function(n){if(i.$obj.isUndefined(n)||n===null)throw new r.errors.nullParameterException("target");var t=n,u=function(n,t,i,r,u,f,e){n.fillStyle=e;n.save();n.beginPath();n.translate(t,i);n.rotate(r);n.moveTo(0,-10);n.lineTo(f,u);n.lineTo(f*-1,u);n.closePath();n.restore();n.fill()};return i.$obj.extend(new s,{name:"arrow"+i.$obj.generateId(),clearAllLinks:function(){return i.$obj.isValid(this.getParent())&&i.$obj.is(this.getParent().removeLinkFrom,"function")&&i.$obj.is(t.removeLinkTo,"function")&&(this.getParent().removeLinkFrom(t).removeLinkTo(t),t.removeLinkFrom(this.getParent()).removeLinkTo(this.getParent())),this},elementDisabledNotification:function(n){(n===t||n===this.getParent())&&this.disable()},graphNode:!1,canHandleEvents:function(){return!1},isSerializable:function(){return!1},getType:function(){return e.arrow},canLink:function(){return!1},isLinkable:function(){return!1},border:{color:"gray",active:!0,width:2},fillColor:"rgba(0,0,0,0.3)",getWidth:function(){return 1},getHeight:function(){return 1},drawTo:function(n,r){var e,o;i.$obj.isValid(t.notifyDisableStateOn)&&t.notifyDisableStateOn(this);i.$obj.isValid(this.getParent().notifyDisableStateOn)&&this.getParent().notifyDisableStateOn(this);var c=t.getAdjustedCoordinates?t.getAdjustedCoordinates():{x:t.x,y:t.y},f=this.getParent(),l=f.getAdjustedCoordinates(),s=l.x+(f.getAdjustedWidth?f.getAdjustedWidth()/2:0),h=l.y+(f.getAdjustedHeight?f.getAdjustedHeight()/2:0);this.x=c.x+(t.getAdjustedWidth?t.getAdjustedWidth()/2:0);this.y=c.y+(t.getAdjustedHeight?t.getAdjustedHeight()/2:0);r.beginPath();r.fillStyle=this.fillColor;this.border.active===!0&&(e=r.createLinearGradient(this.x,this.y,s,h),e.addColorStop(0,this.border.color),e.addColorStop(.5,this.fillColor),e.addColorStop(1,this.border.color),r.lineWidth=this.border.width,r.strokeStyle=e);r.moveTo(this.x,this.y);r.lineTo(s,h);r.stroke();o=Math.atan((h-this.y)/(s-this.x));o+=(s>this.x?-90:90)*Math.PI/180;u(r,this.x,this.y,o,5,8,this.fillColor);this.border.active===!0?u(r,this.x,this.y,o,3,5,this.border.color):u(r,this.x,this.y,o,3,5,"white")}},!0)},htmlElement:function(n){var t,u;if(!i.$obj.isValid(n)){t=new r.errors.nullParameterException("element");console.error(t.message);throw t;}return u=n,i.$obj.extend(new s,{name:"htmlElement"+i.$obj.generateId(),canHandleEvents:function(){return!1},getType:function(){return e.html},graphNode:!1,isSerializable:function(){return!1},canLink:function(){return!1},isLinkable:function(){return!1},border:{active:!1},fillColor:"",getWidth:function(){return n.clientWidth},getHeight:function(){return n.clientHeight},drawTo:function(){},existsIn:function(){return!1},handleInteractions:!0,onIteraction:function(n,t){var r=function(i){t(i,u,n)};i.$device.on(u,n,r)}},!0)},triangle:function(n){var t={p2:{x:0,y:0},p3:{x:0,y:0}};return i.$obj.extend(new s,{name:"triangle"+i.$obj.generateId(),border:{color:"gray",active:!0,width:2},getType:function(){return e.triangle},fillColor:"silver",pointingUp:n!==!1,dimensions:{width:50,height:50},setWidth:function(n){return this.dimensions.width=n,this},getWidth:function(){return this.dimensions.width},setHeight:function(n){return this.dimensions.height=n,this},getAdjustedHeight:function(){return this.pointingUp===!0?this.dimensions.height*-1:this.dimensions.height/2},getHeight:function(){return this.dimensions.height},drawTo:function(n,i){var u=this.pointingUp===!1?function(n,t){return n+t}:function(n,t){return n-t},r=this.getAdjustedCoordinates();i.beginPath();i.fillStyle=this.fillColor;i.moveTo(r.x,r.y);i.lineTo(t.p2.x=r.x+this.dimensions.width/2,t.p2.y=u(r.y,this.dimensions.height));i.lineTo(t.p3.x=r.x+this.dimensions.width,t.p3.y=r.y);i.closePath();this.border.active===!0&&(i.lineWidth=this.border.width,i.strokeStyle=this.border.color);i.fill();i.stroke()},existsIn:function(n,i){var h=this.getAdjustedCoordinates(),u=h,f=t.p2,r=t.p3,e={x:n,y:i},o=((f.y-r.y)*(e.x-r.x)+(r.x-f.x)*(e.y-r.y))/((f.y-r.y)*(u.x-r.x)+(r.x-f.x)*(u.y-r.y)),s=((r.y-u.y)*(e.x-r.x)+(u.x-r.x)*(e.y-r.y))/((f.y-r.y)*(u.x-r.x)+(r.x-f.x)*(u.y-r.y)),c=1-o-s;return o>0&&s>0&&c>0},adjustPosition:function(n,t){var i=this.getParent();if(this.position===o.relative&&i!==null){var s=i.getAdjustedCoordinates(),r=i.getWidth()/2,u=i.getHeight()/2,f=n-s.x-r,e=t-s.y-u;this.x=f<0?Math.max(f,r*-1):Math.min(f,r);this.y=e<0?Math.max(e,u*-1):Math.min(e,u)}else this.x=n,this.y=t;return this}},!0)},circle:function(){return i.$obj.extend(new s,{name:"circle"+i.$obj.generateId(),border:{color:"gray",active:!1,width:2},getType:function(){return e.circle},fillColor:"silver",radius:20,setWidth:function(n){return this.radius=n/2,this},getWidth:function(){return this.radius*2},getAdjustedWidth:function(){return this.radius/2},setHeight:function(n){return this.radius=n/2,this},getAdjustedHeight:function(){return this.radius/2},getHeight:function(){return this.radius*2},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.beginPath();t.arc(i.x,i.y,this.radius,0,2*Math.PI,!1);t.fillStyle=this.fillColor;t.fill();this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color,t.stroke())},existsIn:function(n,t){var i=this.x-n,r=this.y-t;return i*i+r*r<this.radius*this.radius},getBoundaries:function(){var n=this.radius/2;return{x:n,y:n,minX:n*-1,minY:n*-1}},adjustPosition:function(n,t){var r=this.getParent();if(this.position===o.relative&&r!==null){var e=r.getAdjustedCoordinates(),i=r.getBoundaries(),s=i.x,h=i.y,u=n-e.x-s,f=t-e.y-h;this.x=u<0?Math.max(u,i.minX):Math.min(u,s);this.y=f<0?Math.max(f,i.minY):Math.min(f,h)}else this.x=n,this.y=t;return this}},!0)}},f=null,v=function(){var n={click:0,mousemove:1},t=function(n){return function(t,i,r){n({x:u.mouseHelper.getX(t),y:u.mouseHelper.getY(t),details:{interactionType:r,targetElement:i}})}};return{getInteractionTypes:n,register:function(r,u,f){if(u in n&&i.$obj.isValid(r)&&r.handleInteractions===!0)r.onIteraction(u,t(f))}}}(),u=function(){var u=[],h=!1,e=null,v=null,s=null,y=function(){h===!0&&(tt(),n.requestAnimationFrame(y))},p=function(n){var i,t;for(n.drawTo(e,s),i=n.getChildElements(),t=0;t<i.length;t++)p(i[t])},o={getX:function(n){return i.$device.gathersXYPositionFrom(e,n).x},getY:function(n){return i.$device.gathersXYPositionFrom(e,n).y},staticCoordinates:function(){var n={clientX:0,clientY:0},t=!1;return{getXY:function(){return t||(e.onmousemove=function(t){n.clientX=t.clientX;n.clientY=t.clientY+30},t=!0),{x:o.getX(n),y:o.getY(n)}}}}()},t={reference:null,holdingCTRL:!1,originalBorder:{},dragTypes:{moving:1,linking:3},dragType:0,temporaryLinkArrow:function(){return{tryRender:function(){if(t.reference!==null&&t.dragType===t.dragTypes.linking&&t.reference.isLinkable()===!0){var i=o.staticCoordinates.getXY(),n=new r.arrow({x:i.x,y:i.y-30,getHeight:function(){return 0}});n.name="_temp";n.setParent(t.reference);n.drawTo(e,s)}return this}}}(),border:{whenMoving:{color:"yellow",active:!0},whenLiking:{color:"green",active:!0}}},w=function(n){t.reference!==null&&t.dragType===t.dragTypes.moving&&(i.$log.info("Moving element",t),t.reference.x=o.getX(n),t.reference.y=o.getY(n))},a=function(n){if(t.reference!==null){if(t.dragType===t.dragTypes.linking)for(var i=0;i<u.length;i++)if(u[i]!==t.reference&&u[i].existsIn(o.getX(n),o.getY(n))&&t.reference.addLinkTo(u[i])){u.push(new r.arrow(u[i]).setParent(t.reference));break}t.reference.on.release(o.getX(n),o.getY(n),t.reference,n);t.reference.border=t.originalBorder;t.reference=null}},b=function(n){return i.$log.info("Removing element",n),n.disable(),u.splice(u.indexOf(n),1),this},d=function(n){return i.$log.info("Adding element",n),u.push(n),this},g=function(){return t.holdingCTRL=!1,this},nt=function(n){var i=n.keyCode||n.charCode;return(i===46||i===8)&&t.reference!==null?(b(t.reference.clearAllLinks()),t.reference=null):t.holdingCTRL=i===17,this},k=function(r){var f,e;for(r=r||n.event,f=0;f<u.length;f++)u[f].existsIn(o.getX(r),o.getY(r))&&(t.reference=u[f]).canHandleEvents()&&t.reference.on.click(o.getX(r),o.getY(r),t.reference,r);return t.reference!==null&&(e=t.dragTypes.moving,i.$device.isTouch||(e=t.holdingCTRL===!0&&t.reference.isLinkable()===!0?t.dragTypes.linking:r.which),t.originalBorder=t.reference.border,t.reference.border=(t.dragType=e)===t.dragTypes.moving?t.border.whenMoving:t.border.whenLiking,i.$log.info("Dragging element",{r:t.reference,d:e})),r.preventDefault?r.preventDefault():r.returnValue&&(r.returnValue=!1),!1},tt=function(){var o,h;if(e===null){s=(e=c("#"+f.targetCanvasId)).getContext("2d");i.$dom.get(e).on("mousedown",k).on("mousemove",w).on("contextmenu",function(n){return n.preventDefault(),!1});i.$obj.isArray(f.toolboxButtons)&&(o=i.$dom.get(e),o.getParent().attr("id")!==f.targetCanvasContainerId&&o.getParent().addChild("div").attr("id",f.targetCanvasContainerId).addChild(o.raw()),i.$obj.forEach(f.toolboxButtons,function(n){o.addSibling("div").attr("id",n.id=i.$obj.generateId()).html(n.template).on("click",function(){n.onclick(e)})}));i.$dom.get(n).on("mouseup",a).on("keydown",nt).on("keyup",g);if(i.$device.isTouch===!0){i.$dom.get(e).on("touchstart",k).on("touchmove",w);i.$dom.get(n).on("touchend",a).on("touchcancel",a)}v=i.$obj.extend(new r.htmlElement(e),{})}for(s.clearRect(0,0,e.width,e.height),h=0;h<u.length;h++)p(u[h]);return t.temporaryLinkArrow.tryRender(),this},it=function(){for(var f={},n,t,i=0;i<u.length;i++)if(n=u[i],n.graphNode===!0){if(((t=n.getLinksFrom())===null||t.length===0)&&((t=n.getLinksTo())===null||t.length===0))throw new r.errors.elementDoesNotHaveALink(n.name);f[n.name]=new l(n,null,n.getLinksTo())}return f};return{mouseHelper:o,addElement:function(n){return d(n),this},getDataUrl:function(){return e.toDataURL()},remove:function(n){return b(n),this},getElementsSlim:function(){return it()},getElements:function(){return u},reloadUsing:function(n){u=n;this.initializeTimedDrawing()},getCanvasElement:function(){return v},getCanvas:function(){return e},initializeTimedDrawing:function(){h===!1&&(h=!0,y())}}}(),h={newLabel:function(n){return i.$obj.extend(new r.label,n)},newSquare:function(){return i.$obj.extend(new r.square,{})},newTriangle:function(n){return i.$obj.extend(new r.triangle(n),{})},newCircle:function(){return i.$obj.extend(new r.circle,{})},plot:function(n){return u.addElement(n),h},exportImage:function(){var t=n.open();return t.document.write("<img src='"+u.getDataUrl()+"'>"),h},getElementsRaw:function(){return u.getElements()},getElementsSlim:function(){return u.getElementsSlim()},getElementsString:function(){return i.$obj.deconstruct(u.getElements())},loadElementsFrom:function(n){var e=JSON.parse(n),a,s,h,c;if(i.$obj.isArray(e)){for(var f=[],l=[],t=0,o=null,t=0;t<e.length;t++){if((o=i.$obj.recreate(e[t]))===null)return alert("Invalid JSON. See the console for more info"),console.error("Could not deserialize this element",e[t]),this;e[t].parent===null?(o.originalIndex=t,f.push(o)):l.push(o)}for(a=function(n){function t(t){for(var i=0;i<t.length;i++)if(t[i].name===n)return t[i]}if(!i.$obj.isValid(n))return null;var u=t(f)||t(l);if(!u)throw r.errors.itemNotFoundException(n);return u},t=0;t<f.length;t++)i.$obj.recreateLinks(f[t],e[f[t].originalIndex],a),delete f[t].originalIndex;for(s=[],t=0;t<f.length;t++)if(h=f[t],h.isLinkable()===!0&&(s=h.getLinksTo()).length>0)for(c=0;c<s.length;c++)f.push(new r.arrow(s[c]).setParent(h));u.reloadUsing(f)}return this},toggleFullScreen:function(){return a.toggleFullScreen(u.getCanvas()),h},positionTypes:function(){return o}(),installUsing:function(n){return f=i.$obj.extend(r.library,n),u.initializeTimedDrawing(),h},onCanvasInteraction:function(n,t){return v.register(u.getCanvasElement(),n,t),this},checkCollisionOn:function(n,t){return h.tryGetElementOn(n,t)!==null},tryGetElementOn:function(n,t){for(var r=u.getElements(),i=0;i<r.length;i++)if(r[i].existsIn(n,t)===!0)return r[i];return null},remove:function(n){return u.remove(n),this},getCanvasBoundaries:function(){var n=u.getCanvasElement();return{maxH:n.getHeight(),maxW:n.getWidth()}},clear:function(){return u.reloadUsing([]),this},$$:{$h:i,$q:c,$c:f}};n.raska=h})(window,document);
//# sourceMappingURL=raska.min.js.map
