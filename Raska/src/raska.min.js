(function(n){"use strict";var t=function(){return{$log:{active:!0,info:function(n,t){this.active===!0&&console.info(n,t)}},$obj:function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return{is:function(n,t){return typeof n===t},generateId:function(){return"__"+n()+n()+n()+n()+n()+n()+n()+n()},isValid:function(n){return!this.is(n,"undefined")&&n!==null},isUndefined:function(n){return this.is(n,"undefined")},extend:function(n,t,i){var u={},r=null;if(this.isUndefined(t))for(r in n)u[r]=n[r];else{i===!0&&(u=t);for(r in n)u.hasOwnProperty(r)||(u[r]=t.hasOwnProperty(r)?t[r]:n[r])}return u}}}()}}(),s=function(n,i,r){var f=i||null,e=[],u;for(this.element=n,this.hasParent=function(n){return f!==null&&(f.element===n||f.getName()===n.name||f.hasParent(n))},this.getParentGraphNodeFor=function(n){return this.element===n||this.getName()===n.name?this:f!==null?this.getParent(n):null},this.getName=function(){return n.name},this.getParent=function(){return f},this.getLinks=function(){return e},u=0;u<r.length;u++)r[u].graphNode===!0&&(this.hasParent(r[u])?t.$log.info("ingored parent node",this.getParentGraphNodeFor(r[u])):e.push(new s(r[u],this,r[u].getLinksTo())))},u={relative:0,absolute:1},f=function(){function e(n,t){for(var i=0;i<n.length;i++)t(n[i]);return[]}var r=null,n=[],t=[],f=[];return{name:"anonymous",graphNode:!0,addLinkTo:function(t){return n.indexOf(t)===-1&&t!==this&&(n.push(t),t.addLinkFrom(this)),this},removeLinkTo:function(t){return n.splice(n.indexOf(t),1),this},getLinksTo:function(){return n},addLinkFrom:function(n){return t.indexOf(n)===-1&&n!==this&&(t.push(n),n.addLinkTo(this)),this},getLinksFrom:function(){return t},removeLinkFrom:function(n){return t.splice(t.indexOf(n),1),this},clearAllLinks:function(){return n=e(n,function(n){n.removeLinkFrom(this)}),t=e(t,function(n){n.removeLinkTo(this)}),this},getChildElements:function(){return f},addChild:function(n){return n.setParent(this),f.push(n),this},getParent:function(){return r},getBoundaries:function(){return{x:this.getWidth(),y:this.getHeight(),minX:0,minY:0}},setParent:function(n){return r=n,this},border:{color:null,active:!1,width:0},position:u.relative,x:50,y:50,getAdjustedCoordinates:function(){if(this.position===u.relative&&r!==null){var n=r.getAdjustedCoordinates();return{x:this.x+n.x,y:this.y+n.y}}return{x:this.x,y:this.y}},adjustPosition:function(){console.error(i.errors.notImplementedException);throw i.errors.notImplementedException;},getWidth:function(){console.error(i.errors.notImplementedException);throw i.errors.notImplementedException;},getHeight:function(){console.error(i.errors.notImplementedException);throw i.errors.notImplementedException;},existsIn:function(){console.error(i.errors.notImplementedException);throw i.errors.notImplementedException;},drawTo:function(){console.error(i.errors.notImplementedException);throw i.errors.notImplementedException;}}},i={library:{readonly:!1,frameRefreshRate:20,targetCanvasId:""},errors:{notImplementedException:{message:"Not implemented",code:0},nullParameterException:function(n){if(typeof n=="undefined"||n===null)throw new this.nullParameterException("parameterName");this.message="Parameter can't be null";this.parameterName=n;this.code=1},elementDoesNotHaveALink:function(n){if(typeof n=="undefined"||n===null)throw new this.nullParameterException("elementName");this.message="Element '"+n+"' doesn't have a valid linked sibling";this.elementName=n;this.code=1}},label:function(){return t.$obj.extend(new f,{name:"label"+t.$obj.generateId(),graphNode:!1,text:"",color:"white",x:0,y:0,border:{color:"red",active:!0,width:4},font:{family:"Tahoma",size:"12px"},getWidth:function(){return this.text.length*5},getHeight:function(){return this.font.size},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.font=this.font.size+" "+this.font.family;t.textBaseline="middle";t.textAlign="center";this.border.active===!0&&(t.lineJoin="round",t.lineWidth=this.border.width,t.strokeStyle=this.border.color,t.strokeText(this.text,i.x,i.y));t.fillStyle=this.color;t.fillText(this.text,i.x,i.y)},existsIn:function(){return!1}},!0)},square:function(){return t.$obj.extend(new f,{name:"square"+t.$obj.generateId(),border:{color:"gray",active:!0,width:4},fillColor:"silver",dimensions:{width:30,height:50},globalAlpha:1,getWidth:function(){return this.dimensions.width},getHeight:function(){return this.dimensions.height},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.beginPath();t.rect(i.x,i.y,this.dimensions.width,this.dimensions.height);t.fillStyle=this.fillColor;this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.globalAlpha=this.globalAlpha;t.fill();t.stroke()},existsIn:function(n,t){return n>this.x-this.dimensions.width&&n<this.x+this.dimensions.width&&t>this.y-this.dimensions.height&&t<this.y+this.dimensions.height},adjustPosition:function(n,t){if(this.position===u.relative&&$parent!==null){var o=$parent.getAdjustedCoordinates(),i=$parent.getWidth()/2,r=$parent.getHeight()/2,f=n-o.x-i,e=t-o.y-r;this.x=f<0?Math.max(f,i*-1):Math.min(f,i);this.y=e<0?Math.max(e,r*-1):Math.min(e,r)}else this.x=n,this.y=t;return this}},!0)},arrow:function(n){if(t.$obj.isUndefined(n)||n===null)throw new i.errors.nullParameterException("source");var r=n,u=function(n,t,i,r,u,f,e){n.fillStyle=e;n.save();n.beginPath();n.translate(t,i);n.rotate(r);n.moveTo(0,-10);n.lineTo(f,u);n.lineTo(f*-1,u);n.closePath();n.restore();n.fill()};return t.$obj.extend(new f,{name:"arrow"+t.$obj.generateId(),graphNode:!1,border:{color:"black",active:!0,width:2},fillColor:"black",getWidth:function(){return 1},getHeight:function(){return 1},drawTo:function(n,t){var i,f;this.x=r.x;this.y=r.y+r.getHeight()/2;i=this.getParent();t.beginPath();t.fillStyle=this.fillColor;this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.moveTo(this.x,this.y);t.lineTo(i.x,i.y);t.stroke();f=Math.atan((i.y-this.y)/(i.x-this.x));f+=(i.x>this.x?-90:90)*Math.PI/180;u(t,this.x,this.y,f,23,10,this.fillColor);u(t,this.x,this.y,f,18,6,"white")},existsIn:function(n,t){var i=this.x,r=this.y,u=this.getParent(),f=u.x,e=u.y,o=f-i,s=e-r,h=2,c=Math.floor(Math.abs(s*n-o*t-i*e+f*r)/Math.sqrt(Math.pow(o,2)+Math.pow(s,2)));return this.border.active===!0&&(h=this.border.width),c<=h}},!0)},htmlElement:function(n){var u,r;if(!t.$obj.isValid(n)){u=new i.errors.nullParameterException("element");console.error(u.message);throw u;}return r=n,t.$obj.extend(new f,{name:"htmlElement"+t.$obj.generateId(),graphNode:!1,border:{active:!1},fillColor:"",getWidth:function(){return 0},getHeight:function(){return 0},drawTo:function(){},existsIn:function(){return!1},handleInteractions:!0,onIteraction:function(n,t){var i=function(i){t(i,r,n)};window.addEventListener?r.addEventListener(n,i,!1):window.attachEvent?r.attachEvent("on"+n,i):r["on"+n]=i}},!0)},circle:function(){return t.$obj.extend(new f,{name:"circle"+t.$obj.generateId(),border:{color:"red",active:!0,width:4},fillColor:"black",radius:20,getWidth:function(){return this.radius*2},getHeight:function(){return this.radius*2},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.beginPath();t.arc(i.x,i.y,this.radius,0,2*Math.PI,!1);t.fillStyle=this.fillColor;t.fill();this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.stroke()},existsIn:function(n,t){var i=this.x-n,r=this.y-t;return i*i+r*r<this.radius*this.radius},getBoundaries:function(){var n=this.radius/2;return{x:n,y:n,minX:n*-1,minY:n*-1}},adjustPosition:function(n,t){var r=this.getParent();if(this.position===u.relative&&r!==null){var o=r.getAdjustedCoordinates(),i=r.getBoundaries(),s=i.x,h=i.y,f=n-o.x-s,e=t-o.y-h;this.x=f<0?Math.max(f,i.minX):Math.min(f,s);this.y=e<0?Math.max(e,i.minY):Math.min(e,h)}else this.x=n,this.y=t;return this}},!0)}},o=null,h=function(){var n={click:0,mousemove:1},i=function(n){return function(t,i,u){n({x:r.mouseHelper.getX(t),y:r.mouseHelper.getY(t),details:{interactionType:u,targetElement:i}})}};return{getInteractionTypes:n,register:function(r,u,f){if(u in n&&t.$obj.isValid(r)&&r.handleInteractions===!0)r.onIteraction(u,i(f))}}}(),r=function(){var u=[],c=null,l=!1,f=null,a=null,h=null,v=function(){c!==null&&n.clearTimeout(c);l===!0&&(tt(),c=n.setTimeout(function(){v()},o.frameRefreshRate))},y=function(n){var i,t;for(n.drawTo(f,h),i=n.getChildElements(),t=0;t<i.length;t++)y(i[t])},e={getX:function(n){var t=f.getBoundingClientRect();return(n.clientX-t.left)*(f.width/t.width)},getY:function(n){var t=f.getBoundingClientRect();return(n.clientY-t.top)*(f.height/t.height)},staticCoordinates:function(){var n={clientX:0,clientY:0};return document.onmousemove=function(t){n.clientX=t.pageX;n.clientY=t.pageY},{getXY:function(){return{x:e.getX(n),y:e.getY(n)}}}}()},r={reference:null,holdingCTRL:!1,originalBorder:{},dragTypes:{moving:1,linking:3},dragType:0,temporaryLinkArrow:function(){return{tryRender:function(){if(r.reference!==null&&r.dragType===r.dragTypes.linking){var t=e.staticCoordinates.getXY(),n=new i.arrow({x:t.x,y:t.y,getHeight:function(){return 0}});n.name="_temp";n.setParent(r.reference);n.drawTo(f,h)}return this}}}(),border:{whenMoving:{color:"yellow",active:!0},whenLiking:{color:"green",active:!0}}},p=function(n){r.reference!==null&&r.dragType===r.dragTypes.moving&&(t.$log.info("Moving element",r),r.reference.x=e.getX(n),r.reference.y=e.getY(n))},w=function(n){if(r.reference!==null){if(r.dragType===r.dragTypes.linking)for(var t=0;t<u.length;t++)if(u[t]!==r.reference&&u[t].existsIn(e.getX(n),e.getY(n))){u[t].addLinkFrom(r.reference);u.push(new i.arrow(u[t]).setParent(r.reference));break}r.reference.border=r.originalBorder;r.reference=null}},b=function(n){return t.$log.info("Removing element",n),u.splice(u.indexOf(n),1),this},k=function(n){return t.$log.info("Adding element",n),u.push(n),this},d=function(){return r.holdingCTRL=!1,this},g=function(n){var t=n.keyCode||n.charCode;return(t===46||t===8)&&r.reference!==null?(b(r.reference.clearAllLinks()),r.reference=null):r.holdingCTRL=t===17,this},nt=function(i){var f,o;for(i=i||n.event,f=0;f<u.length;f++)u[f].existsIn(e.getX(i),e.getY(i))&&(r.reference=u[f]);return o=r.holdingCTRL===!0?r.dragTypes.linking:i.which,r.reference!==null&&(r.originalBorder=r.reference.border,r.reference.border=(r.dragType=o)===r.dragTypes.moving?r.border.whenMoving:r.border.whenLiking,t.$log.info("Dragging element",{r:r.reference,d:o})),i.preventDefault?i.preventDefault():i.returnValue&&(i.returnValue=!1),!1},tt=function(){f===null&&(h=(f=document.getElementById(o.targetCanvasId)).getContext("2d"),f.addEventListener("mousedown",nt,!1),n.addEventListener("mousemove",p,!1),n.addEventListener("mouseup",w,!1),n.addEventListener("keydown",g,!1),n.addEventListener("keyup",d,!1),f.addEventListener("contextmenu",function(n){return n.preventDefault(),!1},!1),a=t.$obj.extend(new i.htmlElement(f),{}));h.clearRect(0,0,f.width,f.height);for(var e=0;e<u.length;e++)y(u[e]);return r.temporaryLinkArrow.tryRender(),this},it=function(){for(var f={},n,t,r=0;r<u.length;r++)if(n=u[r],n.graphNode===!0){if(((t=n.getLinksFrom())===null||t.length===0)&&((t=n.getLinksTo())===null||t.length===0))throw new i.errors.elementDoesNotHaveALink(n.name);f[n.name]=new s(n,null,n.getLinksTo())}return f};return{mouseHelper:e,addElement:function(n){return k(n),this},getDataUrl:function(){return f.toDataURL()},getElements:function(){return it()},getCanvasElement:function(){return a},initializeTimedDrawing:function(){l===!1&&(l=!0,v())}}}(),e={newLabel:function(){return t.$obj.extend(new i.label,{})},newSquare:function(){return t.$obj.extend(new i.square,{})},newCircle:function(){return t.$obj.extend(new i.circle,{})},plot:function(n){return r.addElement(n),e},exportImage:function(){var n=window.open();return n.document.write("<img src='"+r.getDataUrl()+"'>"),e},getElements:function(){return r.getElements()},positionTypes:function(){return u}(),installUsing:function(n){return o=t.$obj.extend(i.library,n),r.initializeTimedDrawing(),e},onCanvasInteraction:function(n,t){h.register(r.getCanvasElement(),n,t)}};n.raska=e})(window);
//# sourceMappingURL=raska.min.js.map
