(function(n){"use strict";var i=function(){return{$log:{active:!1,info:function(n,t){this.active===!0&&console.info(n,t)}},$obj:function(){return{is:function(n,t){return typeof n===t},isUndefined:function(n){return this.is(n,"undefined")},extend:function(n,t,i){var u={},r=null;if(this.isUndefined(t))for(r in n)u[r]=n[r];else{i===!0&&(u=t);for(r in n)u.hasOwnProperty(r)||(u[r]=t.hasOwnProperty(r)?t[r]:n[r])}return u}}}()}}(),o={relative:0,absolute:1},r=function(){function f(n,t){for(var i=0;i<n.length;i++)t(n[i]);return[]}var r=null,n=[],i=[],u=[];return{name:"anonymous",addLinkTo:function(t){return n.indexOf(t)===-1&&(n.push(t),t.addLinkFrom(this)),this},removeLinkTo:function(t){return n.splice(n.indexOf(t),1),this},getLinksTo:function(){return n},addLinkFrom:function(n){return i.indexOf(n)===-1&&(i.push(n),n.addLinkTo(this)),this},getLinksFrom:function(){return i},removeLinkFrom:function(n){return i.splice(i.indexOf(n),1),this},clearAllLinks:function(){return n=f(n,function(n){n.removeLinkFrom(this)}),i=f(i,function(n){n.removeLinkTo(this)}),this},getChildElements:function(){return u},addChild:function(n){return n.setParent(this),u.push(n),this},getParent:function(){return r},setParent:function(n){return r=n,this},border:{color:null,active:!1,width:0},position:o.relative,x:50,y:50,getAdjustedCoordinates:function(){if(this.position===o.relative&&r!==null){var n=r.getAdjustedCoordinates();return{x:this.x+n.x,y:this.y+n.y}}return{x:this.x,y:this.y}},getWidth:function(){console.error(t.errors.notImplementedException);throw t.errors.notImplementedException;},getHeight:function(){console.error(t.errors.notImplementedException);throw t.errors.notImplementedException;},existsIn:function(){console.error(t.errors.notImplementedException);throw t.errors.notImplementedException;},drawTo:function(){console.error(t.errors.notImplementedException);throw t.errors.notImplementedException;}}},t={library:{readonly:!1,frameRefreshRate:20,targetCanvasId:""},errors:{notImplementedException:{message:"Not implemented",code:0},nullParameterException:function(n){if(typeof n=="undefined"||n===null)throw new this.nullParameterException("parameterName");this.message="Parameter can't be null";this.parameterName=n;this.code=1}},label:function(){return i.$obj.extend(new r,{name:"label",text:"",color:"white",x:0,y:0,border:{color:"red",active:!0,width:4},font:{family:"Tahoma",size:"12px"},getWidth:function(){return this.text.length*5},getHeight:function(){return this.font.size},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.font=this.font.size+" "+this.font.family;t.textBaseline="middle";t.textAlign="center";this.border.active===!0&&(t.lineJoin="round",t.lineWidth=this.border.width,t.strokeStyle=this.border.color,t.strokeText(this.text,i.x,i.y));t.fillStyle=this.color;t.fillText(this.text,i.x,i.y)},existsIn:function(){return!1}},!0)},square:function(){return i.$obj.extend(new r,{name:"square",border:{color:"gray",active:!0,width:4},fillColor:"silver",dimensions:{width:30,height:50},globalAlpha:1,getWidth:function(){return this.dimensions.width},getHeight:function(){return this.dimensions.height},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.beginPath();t.rect(i.x,i.y,this.dimensions.width,this.dimensions.height);t.fillStyle=this.fillColor;this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.globalAlpha=this.globalAlpha;t.fill();t.stroke()},existsIn:function(n,t){return n>this.x-this.dimensions.width&&n<this.x+this.dimensions.width&&t>this.y-this.dimensions.height&&t<this.y+this.dimensions.height}},!0)},arrow:function(n){if(i.$obj.isUndefined(n)||n===null)throw new t.errors.nullParameterException("source");var u=n,f=function(n,t,i,r,u,f,e){n.fillStyle=e;n.save();n.beginPath();n.translate(t,i);n.rotate(r);n.moveTo(0,-10);n.lineTo(f,u);n.lineTo(f*-1,u);n.closePath();n.restore();n.fill()};return i.$obj.extend(new r,{name:"arrow",border:{color:"black",active:!0,width:2},fillColor:"black",getWidth:function(){return 1},getHeight:function(){return 1},drawTo:function(n,t){var i,r;this.x=u.x;this.y=u.y+u.getHeight()/2;i=this.getParent();t.beginPath();t.fillStyle=this.fillColor;this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.moveTo(this.x,this.y);t.lineTo(i.x,i.y);t.stroke();r=Math.atan((i.y-this.y)/(i.x-this.x));r+=(i.x>this.x?-90:90)*Math.PI/180;f(t,this.x,this.y,r,23,10,this.fillColor);f(t,this.x,this.y,r,18,6,"white")},existsIn:function(n,t){var i=this.x,r=this.y,u=this.getParent(),f=u.x,e=u.y,o=f-i,s=e-r,h=2,c=Math.floor(Math.abs(s*n-o*t-i*e+f*r)/Math.sqrt(Math.pow(o,2)+Math.pow(s,2)));return this.border.active===!0&&(h=this.border.width),c<=h}},!0)},circle:function(){return i.$obj.extend(new r,{name:"circle",border:{color:"red",active:!0,width:4},fillColor:"black",radius:20,getWidth:function(){return this.radius*2},getHeight:function(){return this.radius*2},drawTo:function(n,t){var i=this.getAdjustedCoordinates();t.beginPath();t.arc(i.x,i.y,this.radius,0,2*Math.PI,!1);t.fillStyle=this.fillColor;t.fill();this.border.active===!0&&(t.lineWidth=this.border.width,t.strokeStyle=this.border.color);t.stroke()},existsIn:function(n,t){var i=this.x-n,r=this.y-t;return i*i+r*r<this.radius*this.radius}},!0)}},e=null,u=function(){var u=[],h=null,c=!1,f=null,s=null,a=function(){h!==null&&n.clearTimeout(h);c===!0&&(h=n.setTimeout(function(){nt();a()},e.frameRefreshRate))},v=function(n){n.drawTo(f,s);for(var i=n.getChildElements(),t=0,t=0;t<i.length;t++)i[t].drawTo(f,s)},o={getX:function(n){var t=f.getBoundingClientRect();return(n.clientX-t.left)*(f.width/t.width)},getY:function(n){var t=f.getBoundingClientRect();return(n.clientY-t.top)*(f.height/t.height)},staticCoordinates:function(){var n={clientX:0,clientY:0};return document.onmousemove=function(t){n.clientX=t.pageX;n.clientY=t.pageY},{getXY:function(){return{x:o.getX(n),y:o.getY(n)}}}}()},r={reference:null,holdingCTRL:!1,originalBorder:{},dragTypes:{moving:1,linking:3},dragType:0,temporaryLinkArrow:function(){return{tryRender:function(){if(r.reference!==null&&r.dragType===r.dragTypes.linking){var i=o.staticCoordinates.getXY(),n=new t.arrow({x:i.x,y:i.y,getHeight:function(){return 0}});n.name="_temp";n.setParent(r.reference);n.drawTo(f,s)}return this}}}(),border:{whenMoving:{color:"yellow",active:!0},whenLiking:{color:"green",active:!0}}},y=function(n){r.reference!==null&&r.dragType===r.dragTypes.moving&&(i.$log.info("Moving element",r),r.reference.x=o.getX(n),r.reference.y=o.getY(n))},p=function(n){if(r.reference!==null){if(r.dragType===r.dragTypes.linking)for(var i=0;i<u.length;i++)if(u[i]!==r.reference&&u[i].existsIn(o.getX(n),o.getY(n))){u[i].addLinkFrom(r.reference);u.push(new t.arrow(u[i]).setParent(r.reference));break}r.reference.border=r.originalBorder;r.reference=null}},w=function(n){return i.$log.info("Removing element",n),u.splice(u.indexOf(n),1),this},b=function(n){return i.$log.info("Adding element",n),u.push(n),this},k=function(){return r.holdingCTRL=!1,this},d=function(n){var t=n.keyCode||n.charCode;return(t===46||t===8)&&r.reference!==null?(w(r.reference.clearAllLinks()),r.reference=null):r.holdingCTRL=t===17,this},g=function(t){var f,e;for(t=t||n.event,f=0;f<u.length;f++)u[f].existsIn(o.getX(t),o.getY(t))&&(r.reference=u[f]);return e=r.holdingCTRL===!0?r.dragTypes.linking:t.which,r.reference!==null&&(r.originalBorder=r.reference.border,r.reference.border=(r.dragType=e)===r.dragTypes.moving?r.border.whenMoving:r.border.whenLiking,i.$log.info("Dragging element",{r:r.reference,d:e})),t.preventDefault?t.preventDefault():t.returnValue&&(t.returnValue=!1),!1},nt=function(){f===null&&(s=(f=document.getElementById(e.targetCanvasId)).getContext("2d"),f.addEventListener("mousedown",g,!1),n.addEventListener("mousemove",y,!1),n.addEventListener("mouseup",p,!1),n.addEventListener("keydown",d,!1),n.addEventListener("keyup",k,!1),f.addEventListener("contextmenu",function(n){return n.preventDefault(),!1},!1));s.clearRect(0,0,f.width,f.height);for(var t=0;t<u.length;t++)v(u[t]);return r.temporaryLinkArrow.tryRender(),this},l=function(n,t){for(var u=[],i,r=0;r<n.length;r++)(i=n[r],t!==i)&&u.push({name:i.name,childs:l(i.getChildElements().slice(),t||i),links:l(i.getLinksTo().slice(),t||i)});return u};return{addElement:function(n){return b(n),this},getDataUrl:function(){return f.toDataURL()},getElements:function(){return l(u)},initializeTimedDrawing:function(){c===!1&&(c=!0,a())}}}(),f={newLabel:function(){return i.$obj.extend(new t.label,{})},newSquare:function(){return i.$obj.extend(new t.square,{})},newCircle:function(){return i.$obj.extend(new t.circle,{})},plot:function(n){return u.addElement(n),f},exportImage:function(){var n=window.open();return n.document.write("<img src='"+u.getDataUrl()+"'>"),f},getElements:function(){return u.getElements()},installUsing:function(n){return e=i.$obj.extend(t.library,n),u.initializeTimedDrawing(),f}};n.raska=f})(window);
//# sourceMappingURL=raska.min.js.map
