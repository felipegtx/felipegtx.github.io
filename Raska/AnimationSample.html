<html>
<head>
    <title>Raska</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap-theme.min.css">
</head>
<body>
    <div class="container">
        <nav class="navbar navbar-default navbar-static-top">
            <div class="container-fluid">

                <a class="navbar-brand" href="https://github.com/felipegtx/Raska" target="_blank">Raska!</a>
                <p class="navbar-text  navbar-right">
                    You can find the docs
                    <a href="http://felipegtx.github.io/Raska/docs/index.html" target="_blank">
                        <strong>in here</strong>
                    </a>&nbsp;&nbsp;&nbsp;
                </p>
            </div>
        </nav>
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingI">
                <a role="button" data-toggle="collapse" href="#collapseI" aria-expanded="true" aria-controls="collapseI">
                    <code>DO YOU WANNA PLAY A GAME?</code>
                </a>
            </div>
            <div id="collapseI" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingI">
                <ul class="list-group">
                    <li class="list-group-item">
                        <!--http://pre11.deviantart.net/8a75/th/pre/i/2011/055/9/d/i_want_to_play_a_game___by_masdar_zulfikar-d3aafu4.jpg-->
                        <strong><em>Rapidly</em></strong> <kbd>left-click</kbd> then <kbd>right-click</kbd> to create an linkable circle. Point the arrow to the main square and let go.
                    </li>
                    <li class="list-group-item">
                        <kbd>Click</kbd> anywhere to add new circles
                    </li>
                    <li class="list-group-item">
                        <kbd>Drag</kbd> and move the square around - <em>the inner circle will only move within it</em>
                    </li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <label for="score">Your score</label><input type="text" class="form-control" readonly id="score" value="0"><br />
                <canvas id="raskaContent" style="border: 1px solid silver;" width="700" height="400"></canvas>
            </div>
            <div class="col-md-2"></div>
        </div>
    </div>
    <script type="text/javascript" src="src/raska.min.js"></script>
    <script type="text/javascript" src="src/raska.animation.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script>

        function getRandomColor() {
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        var currentColor = getRandomColor(),
            checkEnd = function (from, to) {
                if (to.getType() === "square") {
                    console.log("WOW! Such hacker! Much color!");
                    currentColor = getRandomColor();
                    raska.$$.$q("#score").value = parseInt(raska.$$.$q("#score").value) + 1;
                }
                return true;
            }

        /// Configures raska to a given Canvas element
        raska.installUsing({ targetCanvasId: "raskaContent" });

        /// Creates an square that contains a circle
        var square = raska.newSquare();
        square.dimensions.width = 200;
        square.dimensions.height = 200;
        square.border.width = 1;
        square.x = 100;
        square.y = 100;
        square.fillColor = "silver";
        var circle = raska.newCircle();
        circle.radius = 30;
        circle.x = 150;
        circle.y = 150;
        circle.fillColor = "yellow";
        circle.border.color = "black";

        /// Renders the square (hence its circle child)
        raska
            .plot(square.addChild(circle))
            .onCanvasInteraction("click",
                function (evtData) {

                    var n_circle = raska.newCircle();
                    n_circle.radius = 30;
                    n_circle.x = evtData.x;
                    n_circle.canLink = checkEnd;
                    n_circle.y = evtData.y;
                    n_circle.fillColor = currentColor;
                    n_circle.border.color = "black";
                    raska.plot(n_circle);
                    animate(n_circle);

                });

        var moveIt = function (x, y) {
            return {
                x: x + 50,
                y: y + 50
            };
        };

        function animate(ele) {

            //// The raska animation
            raska.animation.on(ele)

                /// Configures raska to save the initial state for all animations so we can loop without sidefects
                .saveInitialStates()

                /// Fade in the circle
                .fadeIn()

                /// then move de circle around (inside its parent boundaries)
                .then().move(moveIt).fadeOut()

                /// Execute the animations in loop
                ///     PS: here you can also provide an parameter to set the interval beteween animations
                .loop(300);
        }

        animate(circle);

        /// Random positioning
        var canvasRect = document.getElementById("raskaContent").getBoundingClientRect(),
            padding = 50;
        function getRandomPosition() {
            return {
                x: Math.abs(Math.random() * (canvasRect.width - padding)),
                y: Math.abs(Math.random() * (canvasRect.height - padding))
            };
        }

        /// Triangle DOWN
        position = getRandomPosition();
        var triangleDOWN = raska.newTriangle(false);
        triangleDOWN.setWidth(200);
        triangleDOWN.setHeight(200);
        triangleDOWN.y = position.y;
        triangleDOWN.on.click(function (x, y, ele, evt) { console.log("You've clicked the element ", ele, evt); });
        triangleDOWN.x = position.x;
        var label = raska.newLabel();
        label.text = triangleDOWN.name;
        triangleDOWN.addChild(label);
        raska.plot(triangleDOWN);
        raska.animation.on(triangleDOWN).fadeIn().fadeOut().loop();

    </script>
</body>
</html>